# ReorderingSurvey2025

This repository hosts an experimental framework for studying how matrix reordering affects sparse multiplication performance. The high-level design is described in `AGENTS.md`.

## Repository Layout
- `Raw_Matrices/` – download of original matrices from the SuiteSparse Matrix Collection.
- `Programs/` – Slurm drivers and wrapper scripts for each reordering technique or multiplication kernel.
- `Results/` – output CSVs and permutation files generated by the pipeline.
- `scripts/` – helper utilities such as dataset bootstrap and CSV post-processing.
- `config/` – YAML files describing available techniques and parameter sets.
- `logs/` – Slurm job output.

See `TODO.md` for the current development status and upcoming tasks.

## Customizing Data Locations

By default the matrices and experiment results reside under `Raw_Matrices/` and
`Results/` inside the repository.  Large deployments can place these folders
elsewhere by exporting `MATRIX_DIR` and `RESULTS_DIR` before sourcing
`Programs/exp_config.sh`.

## Installing Reordering Techniques

Run `scripts/bootstrap.sh` to fetch external reorderers. Build them after
loading the necessary modules on your cluster. Rabbit Order (`ro`) requires
`g++` (≥ 4.9.2), `Boost` (≥ 1.58.0), `libnuma` (≥ 2.0.9), and
`libtcmalloc_minimal` from `gperftools` (≥ 2.1); see
`Programs/Reordering/Techniques/README.md` for detailed commands.

## Python Environment

Helper scripts such as `csv_helper.py` rely on `numpy`, `pandas`, `scipy`,
`python-graphblas`, and `py-metis`. Clusters often forbid `pip` or `sudo`, so
make these packages available via the module system or by building them in a
local prefix.

The `requirements.txt` file enumerates the Python packages that need to be
present; satisfy them using modules or local builds.

## Example Slurm Run

Each driver reads a plain text task list; every line becomes one job in the
array. Below is a minimal end-to-end example.

### Reordering

`reorder_tasks.txt`
```
# matrix_path                     reorder_tech  param_set
Raw_Matrices/TEST/matrix.mtx      ro            config/ro_params.json
```

`run_reorder.sh`
```bash
#!/usr/bin/env bash
TASK_FILE=reorder_tasks.txt
sbatch --array=0-$(($(wc -l < "$TASK_FILE")-1)) Programs/Reorder.sbatch
```

Running `run_reorder.sh` prints the Slurm job ID; keep it for the
multiplication step.

### Multiplication

`multiply_tasks.txt`
```
# matrix_dir                                 permutation_path                                      mult_impl  param_set
Results/Reordering/TEST/matrix/ro_config     Results/Reordering/TEST/matrix/ro_config/permutation.g  cusparse   config/mult_params.json
```

`run_multiply.sh`
```bash
#!/usr/bin/env bash
TASK_FILE=multiply_tasks.txt
# Replace REORDER_JOBID with the ID from the reorder submission
sbatch --dependency=afterok:REORDER_JOBID --array=0-$(($(wc -l < "$TASK_FILE")-1)) Programs/Multiply.sbatch
```

The `mult_impl` field selects a wrapper script from
`Programs/Multiplication/Techniques/`.
